name: Build & Deploy Roku Channel

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: Install roku-deploy
      run: npm install -g roku-deploy

    - name: Create package (.zip)
      run: |
        roku-deploy createPackage \
          --outDir ./dist \
          --outFile roku-youtube-proxy-channel
    - name: Upload .zip artifact
      uses: actions/upload-artifact@v4
      with:
        name: roku-channel-zip
        path: dist/roku-youtube-proxy-channel.zip
        if-no-files-found: error

    # Optional: Auto-sideload to your dev Roku on push to main
    # Uncomment and set secrets if you want instant testing on push
    # - name: Deploy to Roku device
    #   if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    #   run: |
    #     roku-deploy deploy \
    #       --host "${{ secrets.ROKU_IP }}" \
    #       --password "${{ secrets.ROKU_PASSWORD }}"
